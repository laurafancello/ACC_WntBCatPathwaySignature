library("ggplot2")
library("ggrepel")
library("dplyr")
outPath <- "./DEanalyses_ACC/CTNNB1mutVsWt/"
# Read input raw counts ---------------------------------------------------
rna <- read.table(file="./ACC_datasets_formatted/tcga/RNAseq_STAR_RawCounts_fromTCGABiolinks_GeneSymbols.txt", sep="\t", header=T)
colnames(rna) <- str_replace_all(colnames(rna), '\\.', "-")
# Read manually curated file with CTNNB1 or ZNRF3 altered samples ---------
# To annotate CTNNB1 and ZNRF3both mut and CN are considered (note that I previously had a bug where ZNRF3 CN were considered wt).
# Generated by code "PDFtoComparePublicCochinACCdata_BcatMutVsWt_AnyGene_debug.R" and manually curated.
curatedMUT <- read.table(file=".ACC_datasets_formatted/tcga/Metadata/CuratedStatus_MUTandCN.txt", header = T, sep="\t")
# Read manually curated file with CTNNB1 or ZNRF3 altered samples ---------
# To annotate CTNNB1 and ZNRF3both mut and CN are considered (note that I previously had a bug where ZNRF3 CN were considered wt).
# Generated by code "PDFtoComparePublicCochinACCdata_BcatMutVsWt_AnyGene_debug.R" and manually curated.
curatedMUT <- read.table(file="./ACC_datasets_formatted/tcga/Metadata/CuratedStatus_MUTandCN.txt", header = T, sep="\t")
curatedMUT
dim(curatedMUT)
dim(rna)
test=readRDS("./ACC_datasets_formatted/tcga/Metadata/tcga_sampleIDs_CTNNB1mut_ZNRF3mut_wt.RDS")
head(test)
dim(test)
test
# Read manually curated file with CTNNB1 or ZNRF3 altered samples ---------
# To annotate CTNNB1 and ZNRF3both mut and CN are considered (note that I previously had a bug where ZNRF3 CN were considered wt).
# Generated by code "PDFtoComparePublicCochinACCdata_BcatMutVsWt_AnyGene_debug.R" and manually curated.
CTNNB1mutWt <- readRDS("./ACC_datasets_formatted/tcga/Metadata/tcga_sampleIDs_CTNNB1mut_ZNRF3mut_wt.RDS")
head(colnames(rna))
rna <- [,which(colnames(rna) %in% CTNNB1mutWt$Sample)]
library("TCGAretriever")
library("ggplot2")
library("ggrepel")
library("dplyr")
outPath <- "./DEanalyses_ACC/CTNNB1mutVsWt/"
# Read input raw counts ---------------------------------------------------
rna <- read.table(file="./ACC_datasets_formatted/tcga/RNAseq_STAR_RawCounts_fromTCGABiolinks_GeneSymbols.txt", sep="\t", header=T)
colnames(rna) <- str_replace_all(colnames(rna), '\\.', "-")
# # Keep only samples for which RNA, MUT and CN are available (n=73) --------
# metadata <- read.table(file="./ACC_datasets_formatted/tcga/Metadata/mutStatus_clin.csv", sep=",", header=T)
# metadata <- metadata[metadata$patientId %in% colnames(rna), ]
# rna <- rna[,which(colnames(rna) %in% unique(metadata$patientId))]
#
# sample_info <- as.data.frame(colnames(rna))
# colnames(sample_info) <- "patientId"
# Read manually curated file with CTNNB1 or ZNRF3 altered samples ---------
# To annotate CTNNB1 and ZNRF3both mut and CN are considered (note that I previously had a bug where ZNRF3 CN were considered wt).
# Generated by code "PDFtoComparePublicCochinACCdata_BcatMutVsWt_AnyGene_debug.R" and manually curated.
CTNNB1mutWt <- readRDS("./ACC_datasets_formatted/tcga/Metadata/tcga_sampleIDs_CTNNB1mut_ZNRF3mut_wt.RDS")
rna <- rna[,which(colnames(rna) %in% CTNNB1mutWt$Sample)]
dim(rna)
CTNNB1mutWt
CTNNB1mutWt <- CTNNB1mutWt[CTNNB1mutWt$Alteration %in% c("CTNNB1_mut","wt")]
CTNNB1mutWt <- CTNNB1mutWt[CTNNB1mutWt$Alteration %in% c("CTNNB1_mut","wt"),]
CTNNB1mutWt <- readRDS("./ACC_datasets_formatted/tcga/Metadata/tcga_sampleIDs_CTNNB1mut_ZNRF3mut_wt.RDS")
rna <- rna[,which(colnames(rna) %in% CTNNB1mutWt$Sample)] # keep only samples with both RNA and MUT/CN information
CTNNB1mutWt <- CTNNB1mutWt[CTNNB1mutWt$Alteration %in% c("CTNNB1_mut","wt"),] # keep only CTNNB1mut and wt samples, discard ZNRF3 altered samples
CTNNB1mutWt$Alteration <- factor(CTNNB1mutWt$Alteration, levels=c("wt","CTNNB1_mut"))
identical(CTNNB1mutWt$Sample, colnames(rna))
# Order samples in counts and metadata the same way
rna <- rna[,match(CTNNB1mutWt$Sample,colnames(rna))]
identical(CTNNB1mutWt$Sample, colnames(rna))
library("SummarizedExperiment")
library("DESeq2")
library("IHW")
library("biomaRt")
library("apeglm")
library("pheatmap")
library("RColorBrewer")
library("reshape2")
library("stringr")
library("TCGAretriever")
library("ggplot2")
library("ggrepel")
library("dplyr")
outPath <- "./DEanalyses_ACC/CTNNB1mutVsWt/"
# Read input raw counts ---------------------------------------------------
rna <- read.table(file="./ACC_datasets_formatted/tcga/RNAseq_STAR_RawCounts_fromTCGABiolinks_GeneSymbols.txt", sep="\t", header=T)
colnames(rna) <- str_replace_all(colnames(rna), '\\.', "-")
CTNNB1mutWt <- readRDS("./ACC_datasets_formatted/tcga/Metadata/tcga_sampleIDs_CTNNB1mut_ZNRF3mut_wt.RDS") # Read manually curated file with CTNNB1 or ZNRF3 altered samples
rna <- rna[,which(colnames(rna) %in% CTNNB1mutWt$Sample)] # keep only samples with both RNA and MUT/CN information
CTNNB1mutWt <- CTNNB1mutWt[CTNNB1mutWt$Alteration %in% c("CTNNB1_mut","wt"),] # keep only CTNNB1mut and wt samples, discard ZNRF3 altered samples
CTNNB1mutWt$Alteration <- factor(CTNNB1mutWt$Alteration, levels=c("wt","CTNNB1_mut"))
# Order samples in counts and metadata the same way
rna <- rna[,match(CTNNB1mutWt$Sample,colnames(rna))]
if(identical(CTNNB1mutWt$Sample, colnames(rna))){
dds <- DESeq2::DESeqDataSetFromMatrix(
countData = rna,
colData = CTNNB1mutWt,
design = ~ Alteration)
dds <- estimateSizeFactors(dds)
dds <- DESeq(dds)
res <- results(dds)
res <- res[!(is.na(res$padj)),]
write.csv(file=paste0(outPath,"DEanalysis_CTNNB1onlyMut_vs_Wt_allGenes_tcga.csv"), res)
}
res <- read.table(file="./ACC_datasets_formatted/Lefevre/Metadata/SuppTable1_DEanalysis_FC_adjPvalue.txt", header=T, sep="\t")
head(res)
colnames(res) <- c("ID", "log2FoldChange", "adjP")
res$log2FoldChange <- -(res$log2FoldChange) # Invert fold change because in original Lefevre paper comparison is B-catenin non expressed versus expressed
RankedList <- res$log2FoldChange
names(RankedList) <- res[,colNameGenes]
library(fgsea)
library(ggplot2)
library(writexl)
library(msigdbr)
library(fgsea)
library(gridExtra)
library(ggplot2)
options(digits=15)
source("./Scripts/DEanalysisAndCo_Functions.R")
analysis = "CTNNB1_vs_wt"
inpath <- "./DEanalyses_ACC/CTNNB1mutVsWt/"
out <- "./DEanalyses_ACC/CTNNB1mutVsWt/GSEAs/"
if (!(file.exists(out))){
dir.create(file.path(out))
}
#  Generate ranked lists --------------------------------------------------
colNameGenes <- "ID"
dataset_name="Heaton"
dataset_name="Lefevre"
res <- read.table(file="./ACC_datasets_formatted/Lefevre/Metadata/SuppTable1_DEanalysis_FC_adjPvalue.txt", header=T, sep="\t")
head(res)
colnames(res) <- c("ID", "log2FoldChange", "adjP")
head(res)
res$log2FoldChange <- -(res$log2FoldChange) # Invert fold change because in original Lefevre paper comparison is B-catenin non expressed versus expressed
RankedList <- res$log2FoldChange
names(RankedList) <- res[,colNameGenes]
if(length( which(is.na(RankedList)))>0){
RankedList <- RankedList[-(which(is.na(RankedList)))]
}
RankedList <- sort(RankedList)
RankedList <- as.data.frame(cbind(names(RankedList),RankedList))
colnames(RankedList) <- c("GeneName","RankedList")
head(RankedList)
write.table(file=paste0(out, "FoldChangeRanked_", analysis, "_",dataset_name,".rnk"), RankedList, col.names = T, row.names = T, sep="\t")
dataset_name="Heaton"
res <- read.csv(file=paste0(inPath, "DEanalysis_CTNNB1onlyMut_vs_Wt_allGenes_Heaton_ACCs.csv"))
res <- read.csv(file=paste0(inpath, "DEanalysis_CTNNB1onlyMut_vs_Wt_allGenes_Heaton_ACCs.csv"))
head(res)
res$log2FoldChange <- res$logFC
RankedList <- res$logFC
names(RankedList) <- res[,colNameGenes]
if(length(which(is.na(RankedList)))>0){
RankedList <- RankedList[-(which(is.na(RankedList)))]
}
RankedList <- sort(RankedList)
RankedList <- as.data.frame(cbind(names(RankedList),RankedList))
colnames(RankedList) <- c("GeneName","RankedList")
write.table(file=paste0(out, "FoldChangeRanked_", analysis, "_",dataset_name,".rnk"), RankedList, col.names = T, row.names = T, sep="\t")
dataset_name="TCGA"
head(RankedList)
res <- read.csv(file=paste0(inpath, "DEanalysis_CTNNB1onlyMut_vs_Wt_allGenes_tcga.csv"))
head(res)
colnames(res) <- c("ID", "baseMean","log2FoldChange","lfcSE","stat","p.value", "padj")
RankedList <- res$log2FoldChange
names(RankedList) <- res[,colNameGenes]
if(length( which(is.na(RankedList)))>0){
RankedList <- RankedList[-(which(is.na(RankedList)))]
}
RankedList <- sort(RankedList)
RankedList <- as.data.frame(cbind(names(RankedList),RankedList))
colnames(RankedList) <- c("GeneName","RankedList")
write.table(file=paste0(out, "FoldChangeRanked_", analysis, "_",dataset_name,".rnk"), RankedList, col.names = T, row.names = T, sep="\t")
# Enrichment analysis based on log2FC of DE annalysis CTNNB1_mut vs wt (Assie and TCGA), Bcat nuclear vs membrane (Heaton), Bcat expressed or repressed in H295R cel line (Lefevre)
RankedListType  <- "FoldChange"
dataset_name="heaton"
dataset_name="Heaton"
RankedList <- read.table(file=paste0(out, RankedListType, "Ranked_", analysis, "_",dataset_name,".rnk"), sep="\t", header=T)
values <- RankedList$RankedList
names(values) <- RankedList$GeneName
RankedList <- values
# Transfrom -Inf into zeros (when calculating log2FC no pseudocount was used)
RankedList[which(RankedList== -Inf)] <- 0
print("Running GSEA on Hallmarks")
outHallmarks <- GSEA_MSigDBHallmark_v2(bulkType=dataset_name, analysis="CTNNB1_vs_wt", RankedList=RankedList, RankedListType=RankedListType, outPath=out, geneIdType="gene_symbol")
saveRDS(file=paste0(out, dataset_name, RankedListType, "_BcatActive_vs_not_Hallmarks.RDS"), outHallmarks[order(outHallmarks$padj),])
h_gene_sets = msigdbr(species = "Homo sapiens", category = "H")
msigdbr_list_H = split(x = h_gene_sets$gene_symbol, f = h_gene_sets$gs_name)
msigdbr_list_H_nr <- lapply(msigdbr_list_H, unique)
datasets <- c("Assie","Heaton","TCGA")
pathways <- c("HALLMARK_MYC_TARGETS_V1","HALLMARK_MYC_TARGETS_V2")
RankedListType <- "FoldChange"
dataset_name
dataset_name="Lefevre"
print(dataset_name)
RankedList <- read.table(file=paste0(out, RankedListType, "Ranked_", analysis, "_",dataset_name,".rnk"), sep="\t", header=T)
values <- RankedList$RankedList
names(values) <- RankedList$GeneName
RankedList <- values
# Transfrom -Inf into zeros (when calculating log2FC no pseudocount was used)
RankedList[which(RankedList== -Inf)] <- 0
print("Running GSEA on Hallmarks")
outHallmarks <- GSEA_MSigDBHallmark_v2(bulkType=dataset_name, analysis="CTNNB1_vs_wt", RankedList=RankedList, RankedListType=RankedListType, outPath=out, geneIdType="gene_symbol")
saveRDS(file=paste0(out, dataset_name, RankedListType, "_BcatActive_vs_not_Hallmarks.RDS"), outHallmarks[order(outHallmarks$padj),])
dataset_name
dataset_name="Heaton"
print(dataset_name)
RankedList <- read.table(file=paste0(out, RankedListType, "Ranked_", analysis, "_",dataset_name,".rnk"), sep="\t", header=T)
values <- RankedList$RankedList
names(values) <- RankedList$GeneName
RankedList <- values
# Transfrom -Inf into zeros (when calculating log2FC no pseudocount was used)
RankedList[which(RankedList== -Inf)] <- 0
print("Running GSEA on Hallmarks")
outHallmarks <- GSEA_MSigDBHallmark_v2(bulkType=dataset_name, analysis="CTNNB1_vs_wt", RankedList=RankedList, RankedListType=RankedListType, outPath=out, geneIdType="gene_symbol")
saveRDS(file=paste0(out, dataset_name, RankedListType, "_BcatActive_vs_not_Hallmarks.RDS"), outHallmarks[order(outHallmarks$padj),])
dataset_name
dataset_name="tcga"
print(dataset_name)
RankedList <- read.table(file=paste0(out, RankedListType, "Ranked_", analysis, "_",dataset_name,".rnk"), sep="\t", header=T)
values <- RankedList$RankedList
names(values) <- RankedList$GeneName
RankedList <- values
# Transfrom -Inf into zeros (when calculating log2FC no pseudocount was used)
RankedList[which(RankedList== -Inf)] <- 0
print("Running GSEA on Hallmarks")
outHallmarks <- GSEA_MSigDBHallmark_v2(bulkType=dataset_name, analysis="CTNNB1_vs_wt", RankedList=RankedList, RankedListType=RankedListType, outPath=out, geneIdType="gene_symbol")
saveRDS(file=paste0(out, dataset_name, RankedListType, "_BcatActive_vs_not_Hallmarks.RDS"), outHallmarks[order(outHallmarks$padj),])
h_gene_sets = msigdbr(species = "Homo sapiens", category = "H")
msigdbr_list_H = split(x = h_gene_sets$gene_symbol, f = h_gene_sets$gs_name)
msigdbr_list_H_nr <- lapply(msigdbr_list_H, unique)
datasets <- c("Assie","Heaton","tcga")
pathways <- c("HALLMARK_MYC_TARGETS_V1","HALLMARK_MYC_TARGETS_V2")
RankedListType <- "FoldChange"
dataset_name="Heaton"
res  <- readRDS(file=paste0(out, dataset_name, "FoldChange_BcatActive_vs_not_Hallmarks.RDS"))
head(res)
Ranks <- read.table(file=paste0(out, RankedListType, "Ranked_CTNNB1_vs_wt_", dataset_name, ".rnk"), header = T, sep="\t")
Ranks_ok <- as.numeric(as.vector(Ranks$RankedList))
names(Ranks_ok) <- as.character(as.vector(Ranks$GeneName))
head(Ranks_ok)
for(path in pathways){
sub <- res[res$pathway==path,]
pval <- signif(sub$pval, digits=3)
padj <- signif(sub$padj, digits=3)
ES <- round(sub$ES, digits=2)
NES <- round(sub$NES, digits=2)
print(sub)
png(file=paste0(out, "PlotGSEA_",path,"_",dataset_name,".png"))
print(plotEnrichment(msigdbr_list_H_nr[[path]],
Ranks_ok) + labs(title=ggtitle(paste0(path, ", ", dataset_name, "\n, p=", pval, ", padj=", padj, ", ES=", ES, ", NES=", NES))))
dev.off()
}
library(fgsea)
library(ggplot2)
library(writexl)
library(msigdbr)
library(fgsea)
library(gridExtra)
library(ggplot2)
options(digits=15)
source("./Scripts/DEanalysisAndCo_Functions.R")
analysis = "CTNNB1_vs_wt"
inpath <- "./DEanalyses_ACC/CTNNB1mutVsWt/"
out <- "./DEanalyses_ACC/CTNNB1mutVsWt/GSEAs/"
if (!(file.exists(out))){
dir.create(file.path(out))
}
#  Run GSEA on Assie, Lefevre, Heaton, TCGA -------------------------------------
#  Generate ranked lists --------------------------------------------------
colNameGenes <- "ID"
for(dataset_name in c("Assie","Lefevre","Heaton", "tcga")){
print(dataset_name)
if(dataset_name == "Assie"){
res <- read.csv(file=paste0(inpath, "./DEanalysis_CTNNB1onlyMut_vs_Wt_allGenes_Assie.csv"))
res$log2FoldChange <- res$logFC
RankedList <- res$log2FoldChange
names(RankedList) <- res[,colNameGenes]
if(length( which(is.na(RankedList)))>0){
RankedList <- RankedList[-(which(is.na(RankedList)))]
}
RankedList <- sort(RankedList)
RankedList <- as.data.frame(cbind(names(RankedList),RankedList))
colnames(RankedList) <- c("GeneName","RankedList")
write.table(file=paste0(out, "FoldChangeRanked_", analysis, "_",dataset_name,".rnk"), RankedList, col.names = T, row.names = T, sep="\t")
}
if(dataset_name == "Lefevre"){
res <- read.table(file="./ACC_datasets_formatted/Lefevre/Metadata/SuppTable1_DEanalysis_FC_adjPvalue.txt", header=T, sep="\t")
colnames(res) <- c("ID", "log2FoldChange", "adjP")
res$log2FoldChange <- -(res$log2FoldChange) # Invert fold change because in original Lefevre paper comparison is B-catenin non expressed versus expressed
RankedList <- res$log2FoldChange
names(RankedList) <- res[,colNameGenes]
if(length( which(is.na(RankedList)))>0){
RankedList <- RankedList[-(which(is.na(RankedList)))]
}
RankedList <- sort(RankedList)
RankedList <- as.data.frame(cbind(names(RankedList),RankedList))
colnames(RankedList) <- c("GeneName","RankedList")
write.table(file=paste0(out, "FoldChangeRanked_", analysis, "_",dataset_name,".rnk"), RankedList, col.names = T, row.names = T, sep="\t")
}
if(dataset_name == "Heaton"){
res <- read.csv(file=paste0(inpath, "DEanalysis_CTNNB1onlyMut_vs_Wt_allGenes_Heaton_ACCs.csv"))
res$log2FoldChange <- res$logFC
RankedList <- res$logFC
names(RankedList) <- res[,colNameGenes]
if(length(which(is.na(RankedList)))>0){
RankedList <- RankedList[-(which(is.na(RankedList)))]
}
RankedList <- sort(RankedList)
RankedList <- as.data.frame(cbind(names(RankedList),RankedList))
colnames(RankedList) <- c("GeneName","RankedList")
write.table(file=paste0(out, "FoldChangeRanked_", analysis, "_",dataset_name,".rnk"), RankedList, col.names = T, row.names = T, sep="\t")
}
if(dataset_name == "tcga"){
res <- read.csv(file=paste0(inpath, "DEanalysis_CTNNB1onlyMut_vs_Wt_allGenes_tcga.csv"))
colnames(res) <- c("ID", "baseMean","log2FoldChange","lfcSE","stat","p.value", "padj")
RankedList <- res$log2FoldChange
names(RankedList) <- res[,colNameGenes]
if(length( which(is.na(RankedList)))>0){
RankedList <- RankedList[-(which(is.na(RankedList)))]
}
RankedList <- sort(RankedList)
RankedList <- as.data.frame(cbind(names(RankedList),RankedList))
colnames(RankedList) <- c("GeneName","RankedList")
write.table(file=paste0(out, "FoldChangeRanked_", analysis, "_",dataset_name,".rnk"), RankedList, col.names = T, row.names = T, sep="\t")
}
}
# Enrichment analysis based on log2FC of DE annalysis CTNNB1_mut vs wt (Assie and TCGA), Bcat nuclear vs membrane (Heaton), Bcat expressed or repressed in H295R cel line (Lefevre)
RankedListType  <- "FoldChange"
datasets <- c("Assie","Lefevre","Heaton","tcga")
for(dataset_name in datasets){
print(dataset_name)
RankedList <- read.table(file=paste0(out, RankedListType, "Ranked_", analysis, "_",dataset_name,".rnk"), sep="\t", header=T)
values <- RankedList$RankedList
names(values) <- RankedList$GeneName
RankedList <- values
# Transfrom -Inf into zeros (when calculating log2FC no pseudocount was used)
RankedList[which(RankedList== -Inf)] <- 0
print("Running GSEA on Hallmarks")
outHallmarks <- GSEA_MSigDBHallmark_v2(bulkType=dataset_name, analysis="CTNNB1_vs_wt", RankedList=RankedList, RankedListType=RankedListType, outPath=out, geneIdType="gene_symbol")
saveRDS(file=paste0(out, dataset_name, RankedListType, "_BcatActive_vs_not_Hallmarks.RDS"), outHallmarks[order(outHallmarks$padj),])
}
# Plot GSEA Hallmarks pathways of interest --------------------------------
h_gene_sets = msigdbr(species = "Homo sapiens", category = "H")
msigdbr_list_H = split(x = h_gene_sets$gene_symbol, f = h_gene_sets$gs_name)
msigdbr_list_H_nr <- lapply(msigdbr_list_H, unique)
datasets <- c("Assie","Heaton","Lefevre","tcga")
pathways <- c("HALLMARK_MYC_TARGETS_V1","HALLMARK_MYC_TARGETS_V2")
RankedListType <- "FoldChange"
for(dataset_name in datasets){
res  <- readRDS(file=paste0(out, dataset_name, "FoldChange_BcatActive_vs_not_Hallmarks.RDS"))
Ranks <- read.table(file=paste0(out, RankedListType, "Ranked_CTNNB1_vs_wt_", dataset_name, ".rnk"), header = T, sep="\t")
Ranks_ok <- as.numeric(as.vector(Ranks$RankedList))
names(Ranks_ok) <- as.character(as.vector(Ranks$GeneName))
for(path in pathways){
sub <- res[res$pathway==path,]
pval <- signif(sub$pval, digits=3)
padj <- signif(sub$padj, digits=3)
ES <- round(sub$ES, digits=2)
NES <- round(sub$NES, digits=2)
print(sub)
png(file=paste0(out, "PlotGSEA_",path,"_",dataset_name,".png"))
print(plotEnrichment(msigdbr_list_H_nr[[path]],
Ranks_ok) + labs(title=ggtitle(paste0(path, ", ", dataset_name, "\n, p=", pval, ", padj=", padj, ", ES=", ES, ", NES=", NES))))
dev.off()
}
}
dataset_name="Hetaon"
dataset_name="Heaton"
res  <- readRDS(file=paste0(out, dataset_name, "FoldChange_BcatActive_vs_not_Hallmarks.RDS"))
head(res)
res
library(fgsea)
library(ggplot2)
library(writexl)
library(msigdbr)
library(fgsea)
library(gridExtra)
library(ggplot2)
options(digits=15)
source("./Scripts/DEanalysisAndCo_Functions.R")
analysis = "CTNNB1_vs_wt"
inpath <- "./DEanalyses_ACC/CTNNB1mutVsWt/"
out <- "./DEanalyses_ACC/CTNNB1mutVsWt/GSEAs/"
if (!(file.exists(out))){
dir.create(file.path(out))
}
#  Run GSEA on Assie, Lefevre, Heaton, TCGA -------------------------------------
#  Generate ranked lists --------------------------------------------------
colNameGenes <- "ID"
for(dataset_name in c("Assie","Lefevre","Heaton", "tcga")){
print(dataset_name)
if(dataset_name == "Assie"){
res <- read.csv(file=paste0(inpath, "./DEanalysis_CTNNB1onlyMut_vs_Wt_allGenes_Assie.csv"))
res$log2FoldChange <- res$logFC
RankedList <- res$log2FoldChange
names(RankedList) <- res[,colNameGenes]
if(length( which(is.na(RankedList)))>0){
RankedList <- RankedList[-(which(is.na(RankedList)))]
}
RankedList <- sort(RankedList)
RankedList <- as.data.frame(cbind(names(RankedList),RankedList))
colnames(RankedList) <- c("GeneName","RankedList")
write.table(file=paste0(out, "FoldChangeRanked_", analysis, "_",dataset_name,".rnk"), RankedList, col.names = T, row.names = T, sep="\t")
}
if(dataset_name == "Lefevre"){
# Note that for Lefevre dataset the comparison is B-Catenin inactivated by shRNA versus constitutively expressed
res <- read.table(file="./ACC_datasets_formatted/Lefevre/Metadata/SuppTable1_DEanalysis_FC_adjPvalue.txt", header=T, sep="\t")
colnames(res) <- c("ID", "log2FoldChange", "adjP")
RankedList <- res$log2FoldChange
names(RankedList) <- res[,colNameGenes]
if(length( which(is.na(RankedList)))>0){
RankedList <- RankedList[-(which(is.na(RankedList)))]
}
RankedList <- sort(RankedList)
RankedList <- as.data.frame(cbind(names(RankedList),RankedList))
colnames(RankedList) <- c("GeneName","RankedList")
write.table(file=paste0(out, "FoldChangeRanked_", analysis, "_",dataset_name,".rnk"), RankedList, col.names = T, row.names = T, sep="\t")
}
if(dataset_name == "Heaton"){
res <- read.csv(file=paste0(inpath, "DEanalysis_CTNNB1onlyMut_vs_Wt_allGenes_Heaton_ACCs.csv"))
res$log2FoldChange <- res$logFC
RankedList <- res$logFC
names(RankedList) <- res[,colNameGenes]
if(length(which(is.na(RankedList)))>0){
RankedList <- RankedList[-(which(is.na(RankedList)))]
}
RankedList <- sort(RankedList)
RankedList <- as.data.frame(cbind(names(RankedList),RankedList))
colnames(RankedList) <- c("GeneName","RankedList")
write.table(file=paste0(out, "FoldChangeRanked_", analysis, "_",dataset_name,".rnk"), RankedList, col.names = T, row.names = T, sep="\t")
}
if(dataset_name == "tcga"){
res <- read.csv(file=paste0(inpath, "DEanalysis_CTNNB1onlyMut_vs_Wt_allGenes_tcga.csv"))
colnames(res) <- c("ID", "baseMean","log2FoldChange","lfcSE","stat","p.value", "padj")
RankedList <- res$log2FoldChange
names(RankedList) <- res[,colNameGenes]
if(length( which(is.na(RankedList)))>0){
RankedList <- RankedList[-(which(is.na(RankedList)))]
}
RankedList <- sort(RankedList)
RankedList <- as.data.frame(cbind(names(RankedList),RankedList))
colnames(RankedList) <- c("GeneName","RankedList")
write.table(file=paste0(out, "FoldChangeRanked_", analysis, "_",dataset_name,".rnk"), RankedList, col.names = T, row.names = T, sep="\t")
}
}
# Enrichment analysis based on log2FC of DE annalysis CTNNB1_mut vs wt (Assie and TCGA), Bcat nuclear vs membrane (Heaton), Bcat expressed or repressed in H295R cel line (Lefevre)
RankedListType  <- "FoldChange"
datasets <- c("Assie","Lefevre","Heaton","tcga")
for(dataset_name in datasets){
print(dataset_name)
RankedList <- read.table(file=paste0(out, RankedListType, "Ranked_", analysis, "_",dataset_name,".rnk"), sep="\t", header=T)
values <- RankedList$RankedList
names(values) <- RankedList$GeneName
RankedList <- values
# Transfrom -Inf into zeros (when calculating log2FC no pseudocount was used)
RankedList[which(RankedList== -Inf)] <- 0
print("Running GSEA on Hallmarks")
outHallmarks <- GSEA_MSigDBHallmark_v2(bulkType=dataset_name, analysis="CTNNB1_vs_wt", RankedList=RankedList, RankedListType=RankedListType, outPath=out, geneIdType="gene_symbol")
saveRDS(file=paste0(out, dataset_name, RankedListType, "_BcatActive_vs_not_Hallmarks.RDS"), outHallmarks[order(outHallmarks$padj),])
}
# Plot GSEA Hallmarks pathways of interest --------------------------------
h_gene_sets = msigdbr(species = "Homo sapiens", category = "H")
msigdbr_list_H = split(x = h_gene_sets$gene_symbol, f = h_gene_sets$gs_name)
msigdbr_list_H_nr <- lapply(msigdbr_list_H, unique)
datasets <- c("Assie","Heaton","Lefevre","tcga")
pathways <- c("HALLMARK_MYC_TARGETS_V1","HALLMARK_MYC_TARGETS_V2")
RankedListType <- "FoldChange"
for(dataset_name in datasets){
res  <- readRDS(file=paste0(out, dataset_name, "FoldChange_BcatActive_vs_not_Hallmarks.RDS"))
Ranks <- read.table(file=paste0(out, RankedListType, "Ranked_CTNNB1_vs_wt_", dataset_name, ".rnk"), header = T, sep="\t")
Ranks_ok <- as.numeric(as.vector(Ranks$RankedList))
names(Ranks_ok) <- as.character(as.vector(Ranks$GeneName))
for(path in pathways){
sub <- res[res$pathway==path,]
pval <- signif(sub$pval, digits=3)
padj <- signif(sub$padj, digits=3)
ES <- round(sub$ES, digits=2)
NES <- round(sub$NES, digits=2)
print(sub)
png(file=paste0(out, "PlotGSEA_",path,"_",dataset_name,".png"))
print(plotEnrichment(msigdbr_list_H_nr[[path]],
Ranks_ok) + labs(title=ggtitle(paste0(path, ", ", dataset_name, "\n p=", pval, ", padj=", padj, ", ES=", ES, ", NES=", NES))))
dev.off()
}
}
library(tidyr)
library(fgsea)
library(msigdbr)
library(ggplot2)
library(circlize)
library(ComplexHeatmap)
source("./Scripts/DEanalysisAndCo_Functions.R")
# 3. GSEA IMMUNE RELATED GENE SETS ON CTNNB1 MUT vs WT FOLD CHANGES  ------------------------
Correlation_type <- "pearson"
Assie <- readRDS("./DEanalyses_ACC/CTNNB1mutVsWt/GSEAs/AssieFoldChange_BcatActive_vs_not_Hallmarks.RDS")
Assie$Dataset <- "Assie"
#Heaton <- readRDS("./ACC_datasets_formatted/GSEAs_onDEanalyses//HeatonFoldChange_BcatActive_vs_not_Hallmarks.RDS")
Heaton <- readRDS("./DEanalyses_ACC/CTNNB1mutVsWt/GSEAs/HeatonFoldChange_BcatActive_vs_not_Hallmarks.RDS")
Heaton$Dataset <- "Heaton"
out <- "./DEanalyses_ACC/CTNNB1mutVsWt/GSEAs/"
Correlation_type <- "pearson"
out <- "./DEanalyses_ACC/CTNNB1mutVsWt/GSEAs/"
#Assie <- readRDS("./ACC_datasets_formatted/GSEAs_onDEanalyses/AssieFoldChange_BcatActive_vs_not_Hallmarks.RDS")
Assie <- readRDS("./DEanalyses_ACC/CTNNB1mutVsWt/GSEAs/AssieFoldChange_BcatActive_vs_not_Hallmarks.RDS")
Assie$Dataset <- "Assie"
#Heaton <- readRDS("./ACC_datasets_formatted/GSEAs_onDEanalyses//HeatonFoldChange_BcatActive_vs_not_Hallmarks.RDS")
Heaton <- readRDS("./DEanalyses_ACC/CTNNB1mutVsWt/GSEAs/HeatonFoldChange_BcatActive_vs_not_Hallmarks.RDS")
Heaton$Dataset <- "Heaton"
#tcga <- readRDS("./ACC_datasets_formatted/GSEAs_onDEanalyses/TCGAFoldChange_BcatActive_vs_not_Hallmarks.RDS")
tcga <- readRDS("./DEanalyses_ACC/CTNNB1mutVsWt/GSEAs/tcgaFoldChange_BcatActive_vs_not_Hallmarks.RDS")
tcga$Dataset <- "tcga"
input <- rbind(Assie, Heaton, tcga)
pathways <- c("HALLMARK_ALLOGRAFT_REJECTION","HALLMARK_INTERFERON_GAMMA_RESPONSE","HALLMARK_INTERFERON_ALPHA_RESPONSE","HALLMARK_IL6_JAK_STAT3_SIGNALING","HALLMARK_INFLAMMATORY_RESPONSE","HALLMARK_IL2_STAT5_SIGNALING")
input <- input[input$pathway %in% pathways,]
all <- input[,c("pathway","pval","padj","log2err","ES","NES","size","leadingEdge","Dataset")]
all$pathway <- factor(all$pathway, levels=pathways)
all$significant <- ifelse(all$padj < 0.1, "*", "")
png(paste0(out, "ImmuneRelatedPathways_Assie_Heaton_tcga.png"), width=1400, height = 150)
ggplot(data=all, aes(x=NES, y=factor(Dataset, levels=c("tcga","Heaton","Assie")), fill=padj)) +
geom_col() + ylab("dataset") + theme_bw() + facet_wrap(.~pathway, ncol = 6) +
ggtitle("Significant (FDR<0.1) immune-related pathways")
dev.off()
